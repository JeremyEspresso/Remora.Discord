<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/Remora.Discord/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/Remora.Discord/assets/img/favicon.ico" type="image/x-icon">
        <title>Remora.Discord Documentation - Using Undocumented Features</title>
        <link href="/Remora.Discord/assets/css/highlight.css" rel="stylesheet">
        <link href="/Remora.Discord/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/Remora.Discord/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/Remora.Discord/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/Remora.Discord/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/Remora.Discord/assets/css/override.css" rel="stylesheet">
        <script src="/Remora.Discord/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/Remora.Discord/assets/js/bootstrap.min.js"></script>        
        <script src="/Remora.Discord/assets/js/app.min.js"></script>         
        <script src="/Remora.Discord/assets/js/highlight.pack.js"></script>   
        <script src="/Remora.Discord/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/Remora.Discord/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/Remora.Discord/assets/js/mermaid.min.js"></script>
        <script src="/Remora.Discord/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/Remora.Discord/assets/js/html5shiv.min.js"></script>
        <script src="/Remora.Discord/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/Remora.Discord/" class="logo">
                            <span>Remora.Discord Documentation</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/Remora.Discord/guides">Guides</a></li>
        <li><a href="/Remora.Discord/info">Info</a></li>
        <li><a href="/Remora.Discord/api">API</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"></div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li><a href="/Remora.Discord/guides/getting-started">Getting Started</a></li>
                <li class="selected"><a href="/Remora.Discord/guides/undocumented-features">Using Undocumented Features</a></li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Using Undocumented Features</h1>
		</section>
	<section class="content">
		<p>The unfortunate reality of using the Discord API is that, while the online
documentation is extensive, it is not exhaustive. Discord often exposes
undocumented fields, endpoints, and data structures that may still be of use to
developers, even though they aren't ready, finished, or thoroughly documented.</p>
<p>Remora has a few ways for you to access these undocumented features, but beware!
As with any unstable API surface, things may break from one second to the next
without warning.</p>
<h2 id="data">Data</h2>
<h3 id="undocumented-fields">Undocumented Fields</h3>
<p>If you want to implement access to an undocumented field on an existing type,
create a new record that inherits from the existing model, and register it with
the DI system.</p>
<pre><code class="language-cs">public record SomeExistingDataWithMoreStuff(int Existing, int Additional) 
    : SomeExistingData(Existing);
</code></pre>
<p>Note that to <em>override</em> an existing data model, you have to register it <em>after</em>
Remora's own setup.</p>
<pre><code class="language-cs">// Add the base types from Remora
var serviceCollection = new ServiceCollection()
    .AddDiscordGateway(_ =&gt; botToken)
    .AddDiscordCommands(true);

// Add overriding data models
serviceCollection.Configure&lt;JsonSerializerOptions&gt;
(
    options =&gt; 
    {
        options.AddDataObjectConverter&lt;ISomeExistingData, SomeExistingDataWithMoreStuff&gt;();
    }
);
</code></pre>
<p>You can also specialize various parts of the data model when registering it,
such as property names (which is useful for C#-ifying naming of boolean
properties) and their type converters.</p>
<h3 id="undocumented-data-structures">Undocumented Data Structures</h3>
<p>Any undocumented data structure can be added to Remora externally, and treated
as if it were bundled with Remora using the existing DI system.</p>
<p>Suppose we have the following undocumented data:</p>
<pre><code class="language-json">{
  "some_name": 10
}
</code></pre>
<p>You would then model and register the following structures.</p>
<pre><code class="language-cs">public interface ISomeData
{
    int SomeName { get; }
}

public record SomeData(int SomeName) : ISomeData;
</code></pre>
<p>Registration is the same as if you were implementing an undocumented field, but
you may register it before Remora's own types.</p>
<h2 id="gateway">Gateway</h2>
<h3 id="undocumented-events-commands">Undocumented Events &amp; Commands</h3>
<p>Any undocumented event or command can be added to Remora the same way as you
would add a new undocumented data structure. However, you only need to model the
data portion of the event or command.</p>
<p>Suppose we have the following undocumented event:</p>
<pre><code class="language-json">{
  "t": "SOME_UNDOCUMENTED_EVENT",
  "s": 4,
  "op": 0,
  "d": {
      "some_name": 10
  }
}
</code></pre>
<p>You would then model and register the following event data. Note that event
names <em>must</em> match the interface name you create - that is, if the event is
named <code>SOME_EVENT</code>, your interface must be named <code>ISomeEvent</code>.</p>
<pre><code class="language-cs">public interface ISomeUndocumentedEvent
{
    int SomeName { get; }
}

public record SomeUndocumentedEvent(int SomeName) : ISomeUndocumentedEvent;
</code></pre>
<h2 id="rest">REST</h2>
<p>Features that relate to the REST API is customized through one of two methods.</p>
<p>The first is the <code><a href="/Remora.Discord/api/Remora.Discord.Rest/DiscordHttpClient">DiscordHttpClient</a></code> type, which can be accessed and used
through DI. It's a named, transient <code>HttpClient</code>, which takes care of minutia
like authorization headers and respecting rate limits for you. You would mainly
use this type when you want to make requests to completely undocumented
endpoints, or to take complete control over a call to a known endpoint.</p>
<pre><code class="language-cs">public class Somewhere
{
    private readonly <a href="/Remora.Discord/api/Remora.Discord.Rest/DiscordHttpClient">DiscordHttpClient</a> _client;

    public Somewhere(DiscordHttpClient client)
    {
        _client = client;
    }
}
</code></pre>
<p>The second is through the concrete implementations of the API interfaces, which
allow you to perform smaller tweaks or changes to existing API methods, such as
adding headers or JSON payload fields.</p>
<h3 id="undocumented-endpoints">Undocumented Endpoints</h3>
<p>To access an undocumented endpoint, you may use the <code><a href="/Remora.Discord/api/Remora.Discord.Rest/DiscordHttpClient">DiscordHttpClient</a></code> directly
to make any kind of HTTP request, similar to how you might use a normal
<code>HttpClient</code>. All requests made by this client are prepended with the most
recently versioned Discord API base endpoint, which typically looks like this:
<code>https://discord.com/api/v9/</code>. Therefore, you should only use relative endpoints
when making requests.</p>
<pre><code class="language-cs">var result = await _client.GetAsync&lt;ISomeData&gt;($"somewhere/{someId}/data");
</code></pre>
<p>Refer to the existing implementations of endpoints in the library for examples
of how to add JSON parameters, HTTP headers, or similar data.</p>
<h3 id="undocumented-parameters-headers">Undocumented Parameters &amp; Headers</h3>
<p>If you want to provide additional data to an existing endpoint, such as JSON
parameters, HTTP headers, or query string parameters, you can easily add
customizations to <em>all</em> requests made by the API within a particular scope. This
feature is only available to you when you inject the concrete implementation of
an API category, however, and not through the interface.</p>
<p>This means that if you want to, for example, send an additional JSON field when
sending a message, you would need to inject <code><a href="/Remora.Discord/api/Remora.Discord.Rest.API/DiscordRestChannelAPI">DiscordRestChannelAPI</a></code> and not
<code><a href="/Remora.Discord/api/Remora.Discord.API.Abstractions.Rest/IDiscordRestChannelAPI">IDiscordRestChannelAPI</a></code>.</p>
<p>This is useful when an endpoint is discovered to allow undocumented parameters,
or metadata headers such as <code>X-Audit-Log-Reason</code>.</p>
<p>Once you have the concrete implementation available to you, creating a
customization is simple.</p>
<pre><code class="language-cs">using (_ = _api.WithCustomization(r =&gt; r.WithJson(json =&gt; json.WriteString("name", "value"))))
{
    // This call will now have "name": "value" in its JSON payload, in addition
    // to the normal data.
    var result = await _api.SomeEndpointAsync();
}

// This call will not have any additional data
var result = await _api.SomeEndpointAsync();
</code></pre>
<p>The customization uses the same types and logic for configuring a request's
parameters, methods, and headers as implementing a custom endpoint, so if you
learn one you should have no trouble using the other.</p>
<p>Multiple customizations may be in effect at the same time, and will be applied
in the order you create them. A customization is removed from the client when it
is disposed.</p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>